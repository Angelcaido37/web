<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Asistente de C贸digo Python</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-6">

  <h1 class="text-2xl font-bold mb-4">Tutor Inteligente de C贸digos de Python</h1>
  <h2 class="text-2xl font-bold mb-4">By: Dr. Oscar Gabriel Vizcaino Monroy</h2>
  <!-- Switch Offline / IA -->
  <div class="flex items-center mb-4">
    <input type="checkbox" id="mode-toggle" class="w-5 h-5 text-blue-600">
    <label for="mode-toggle" class="ml-2 font-medium text-gray-700">Modo IA (Gemini)</label>
  </div>

  <!-- Selector de archivos -->
  <label class="block mb-2">Selecciona un archivo:</label>
  <select id="file-selector" class="p-2 border rounded mb-4" onchange="loadCodeFromFile()">
    <option value="">-- Elige un archivo --</option>
    <option value="1. Tratamiento_Val_Falt.py">1. Tratamiento_Val_Falt.py</option>
    <option value="2. Detecci贸n y Tratamiento de Outliers.py">2. Detecci贸n y Tratamiento de Outliers.py</option>
    <option value="2a. Detecci贸n de outliers auto auto.py">2a. Detecci贸n de outliers auto auto.py</option>
    <option value="2b. Tratamiento de outliers.py">2b. Tratamiento de outliers.py</option>
    <option value="2c. outliers_ml_isoforest_ocsvm.py">2c. outliers_ml_isoforest_ocsvm.py</option>
    <option value="2d. outliers_multivariados_pca_mahal.py">2d. outliers_multivariados_pca_mahal.py</option>
    <option value="3. Transformacion de variable.py">3. Transformacion de variable.py</option>
    <option value="3a. Detectar var. para trans.py">3a. Detectar var. para trans.py</option>
    <option value="3b. transforma auto.py">3b. transforma auto.py</option>
    <option value="3c. transformaciones_avanzadas_power.py">3c. transformaciones_avanzadas_power.py</option>
    <option value="3d. pipeline_preprocesamiento_auto.py">3d. pipeline_preprocesamiento_auto.py</option>
    <option value="3e. eda_visual_y_correlacion.py">3e. eda_visual_y_correlacion.py</option>
    <option value="4a. reportes_automatizados.py">4a. reportes_automatizados.py</option>
    <option value="Val_falt.py">Val_falt.py</option>
    <option value="Val_falt_Eliminar.py">Val_falt_Eliminar.py</option>
    <option value="Val_falt_Eliminar_Coherente.py">Val_falt_Eliminar_Coherente.py</option>
    <option value="Val_falt_data.py">Val_falt_data.py</option>
  </select>

  <!-- rea donde aparece el c贸digo -->
  <textarea id="code-input" class="w-full h-64 p-3 border rounded mb-4 font-mono text-sm" placeholder="Aqu铆 aparecer谩 tu c贸digo..."></textarea>

  <!-- Bot贸n analizar -->
  <button onclick="analyzeCode()" class="w-full bg-blue-600 text-white py-2 rounded hover:bg-blue-700">Analizar C贸digo</button>

  <!-- rea de explicaci贸n -->
  <div class="mt-6 p-4 bg-white border rounded shadow">
    <h2 class="text-xl font-semibold mb-2">Explicaci贸n del c贸digo</h2>
    <div id="explanation-output" class="text-sm text-gray-700">
      <p class="text-gray-400">Las explicaciones aparecer谩n aqu铆...</p>
    </div>
  </div>

  <!-- Autoevaluaci贸n -->
  <div id="quiz-section" class="mt-8 hidden">
    <div class="p-4 bg-white border rounded shadow">
      <h2 class="text-xl font-semibold mb-4">Autoevaluaci贸n</h2>
      <div id="quiz-questions"></div>
      <button onclick="submitQuiz()" class="mt-4 w-full bg-green-600 text-white py-2 px-4 rounded hover:bg-green-700">
        Verificar Respuestas
      </button>
      <div id="quiz-results" class="mt-4 p-4 rounded-md text-sm font-semibold"></div>
    </div>
  </div>

<script>
  const repoUser = "Angelcaido37";
  const repoName = "Mineria_Datos";
  const branch = "main";

  // API de Gemini
  const apiKey = "AIzaSyCvHZWnEyy6qnHxi9MHjKJlwYCMC1TU2wQ"; 
  const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=${apiKey}`;
  let quizQuestions = [];

  // Cargar c贸digo desde GitHub
  async function loadCodeFromFile() {
    const selectedFile = document.getElementById("file-selector").value;
    const codeInput = document.getElementById("code-input");
    if (selectedFile) {
      try {
        const url = `https://raw.githubusercontent.com/${repoUser}/${repoName}/${branch}/${encodeURIComponent(selectedFile)}`;
        const response = await fetch(url);
        if (!response.ok) throw new Error("No se pudo cargar el archivo.");
        const text = await response.text();
        codeInput.value = text;
      } catch (error) {
        alert("No se pudo cargar el archivo.");
        codeInput.value = "";
      }
    }
  }

  // Analizar c贸digo seg煤n modo seleccionado
  async function analyzeCode() {
    const code = document.getElementById("code-input").value;
    const explanationOutput = document.getElementById("explanation-output");
    const useAI = document.getElementById("mode-toggle").checked; // switch IA / Offline

    if (!code) {
      alert("Primero selecciona o pega un c贸digo.");
      return;
    }

    explanationOutput.innerHTML = '<p class="text-center text-gray-400">Analizando el c贸digo...</p>';
    document.getElementById("quiz-section").classList.add("hidden");
    document.getElementById("quiz-results").innerHTML = "";

    if (useAI) {
      //  Modo IA con Gemini
      try {
        const prompt = `
        Eres un tutor de programaci贸n experto. Explica este c贸digo Python l铆nea por l铆nea y genera 3 preguntas de autoevaluaci贸n en formato JSON.
        Formato: { "explanation": "...", "quiz": [ {"question":"...","options":["a","b","c","d"],"correct_answer":"b"} ] }
        CDIGO: ${code}
        `;
        const payload = { contents: [{ parts: [{ text: prompt }] }] };
        const response = await fetch(apiUrl, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload)
        });
        if (!response.ok) throw new Error("Error en la API");
        const result = await response.json();
        let jsonText = result.candidates?.[0]?.content?.parts?.[0]?.text;
        if (jsonText) {
          jsonText = jsonText.replace(/```json|```/g, "").trim();
          const parsedResult = JSON.parse(jsonText);
          explanationOutput.innerHTML = formatExplanation(parsedResult.explanation);
          quizQuestions = parsedResult.quiz;
          displayQuiz();
          document.getElementById("quiz-section").classList.remove("hidden");
        }
      } catch (error) {
        explanationOutput.innerHTML = `<p class="text-red-500">Hubo un error al analizar con IA.</p>`;
      }
    } else {
      //  Modo Offline (mock) -> SOLO explicaci贸n
      const mockResponse = {
        explanation: `
        def calculate_average(numbers): -> Define una funci贸n que recibe una lista de n煤meros.
            total = sum(numbers) -> Calcula la suma de todos los elementos.
            count = len(numbers) -> Cuenta el n煤mero de elementos.
            return total / count -> Devuelve el promedio.
        `
      };
      explanationOutput.innerHTML = formatExplanation(mockResponse.explanation);
      document.getElementById("quiz-section").classList.add("hidden"); //  siempre oculto en mock
    }
  }

  function formatExplanation(explanation) {
    return explanation.split("\n").map(line => {
      const parts = line.split("->");
      if (parts.length > 1) {
        return `<div class="mb-2">
                  <span class="bg-gray-200 text-gray-800 rounded px-1 font-mono text-xs">${parts[0].trim()}</span>
                  <span class="ml-2">${parts.slice(1).join("->").trim()}</span>
                </div>`;
      } else {
        return `<p class="mb-1">${line}</p>`;
      }
    }).join("");
  }

  function displayQuiz() {
    const quizContainer = document.getElementById("quiz-questions");
    quizContainer.innerHTML = "";
    quizQuestions.forEach((q, index) => {
      quizContainer.innerHTML += `
        <div class="mb-4 p-3 border rounded bg-gray-50">
          <p class="font-medium mb-2">Pregunta ${index+1}: ${q.question}</p>
          ${q.options.map(opt => `
            <label class="block">
              <input type="radio" name="q${index}" value="${opt}"> ${opt}
            </label>
          `).join("")}
        </div>`;
    });
  }

  function submitQuiz() {
    let score = 0;
    let feedback = "";
    quizQuestions.forEach((q, index) => {
      const selected = document.querySelector(`input[name="q${index}"]:checked`);
      if (selected) {
        if (selected.value === q.correct_answer) {
          score++;
          feedback += `<p class="text-green-600">Pregunta ${index+1}: 隆Correcto!</p>`;
        } else {
          feedback += `<p class="text-red-600">Pregunta ${index+1}: Incorrecto. Correcta: ${q.correct_answer}</p>`;
        }
      } else {
        feedback += `<p class="text-yellow-600">Pregunta ${index+1}: Sin responder (correcta: ${q.correct_answer})</p>`;
      }
    });
    document.getElementById("quiz-results").innerHTML = `
      <p class="font-bold">Resultado: ${score} / ${quizQuestions.length}</p>
      ${feedback}
    `;
  }
</script>

</body>
</html>
